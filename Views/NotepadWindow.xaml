<Window x:Class="BMS.Overlay.Views.NotepadWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="BMS Notepad"
        Width="420" Height="500"
        MinWidth="300" MinHeight="250"
        WindowStyle="None" AllowsTransparency="True"
        Background="Transparent"
        Topmost="True" ShowInTaskbar="False"
        ResizeMode="CanResizeWithGrip"
        Closing="Window_Closing">

    <Window.Resources>
        <SolidColorBrush x:Key="NpGold" Color="#D8D8D8"/>
        <SolidColorBrush x:Key="NpGoldText" Color="#D8D8D8"/>
        <SolidColorBrush x:Key="NpBg" Color="#E60A0A0A"/>
        <SolidColorBrush x:Key="NpBgDark" Color="#0D0D0D"/>
        <SolidColorBrush x:Key="NpBorder" Color="#2A2A2A"/>
        <SolidColorBrush x:Key="NpDimText" Color="#6A6A6A"/>

        <!-- Small toolbar button -->
        <Style x:Key="ToolBtn" TargetType="ToggleButton">
            <Setter Property="Width" Value="28"/>
            <Setter Property="Height" Value="26"/>
            <Setter Property="Margin" Value="1"/>
            <Setter Property="Background" Value="#0A0A0A"/>
            <Setter Property="Foreground" Value="#A0A0A0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="Normal"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="bd" Background="{TemplateBinding Background}"
                                BorderThickness="{TemplateBinding BorderThickness}" BorderBrush="#2A2A2A">
                            <Grid>
                                <Rectangle Fill="{StaticResource OverlayDottedTexture}" Opacity="0.35" IsHitTestVisible="False"/>
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bd" Property="BorderBrush" Value="#CCCCCC"/>
                                <Setter Property="Foreground" Value="#FFFFFF"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#0A0A0A"/>
                                <Setter TargetName="bd" Property="BorderBrush" Value="#CCCCCC"/>
                                <Setter Property="Foreground" Value="#FFFFFF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Action button style (non-toggle) -->
        <Style x:Key="ActionBtn" TargetType="Button">
            <Setter Property="Height" Value="26"/>
            <Setter Property="Margin" Value="1"/>
            <Setter Property="Padding" Value="6,0"/>
            <Setter Property="Background" Value="#0A0A0A"/>
            <Setter Property="Foreground" Value="#A0A0A0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bd" Background="{TemplateBinding Background}"
                                BorderBrush="#2A2A2A" BorderThickness="1"
                                Padding="{TemplateBinding Padding}">
                            <Grid>
                                <Rectangle Fill="{StaticResource OverlayDottedTexture}" Opacity="0.35" IsHitTestVisible="False"/>
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bd" Property="BorderBrush" Value="#CCCCCC"/>
                                <Setter Property="Foreground" Value="#FFFFFF"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="bd" Property="Opacity" Value="0.8"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Note list button -->
        <Style x:Key="NoteListBtn" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#D8D8D8"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bd" Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}">
                            <Grid>
                                <Rectangle Fill="{StaticResource OverlayDottedTexture}" Opacity="0.2" IsHitTestVisible="False"/>
                                <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                  VerticalAlignment="Center"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#141414"/>
                                <Setter Property="Foreground" Value="#FFFFFF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FULL EDITOR PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Border x:Name="EditorPanel" Background="{StaticResource NpBg}"
                BorderBrush="{StaticResource NpBorder}" BorderThickness="1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="32"/>   <!-- Title bar -->
                    <RowDefinition Height="Auto"/> <!-- Toolbar -->
                    <RowDefinition Height="*"/>    <!-- Editor / note list -->
                    <RowDefinition Height="Auto"/> <!-- Status bar -->
                </Grid.RowDefinitions>

                <!-- â”€â”€â”€ Title Bar (draggable) â”€â”€â”€ -->
                <Border Grid.Row="0" Background="{StaticResource NpBgDark}"
                        MouseLeftButtonDown="TitleBar_MouseDown">
                    <DockPanel Margin="8,0">
                        <TextBlock Text="BMS NOTEPAD" Foreground="{StaticResource NpGoldText}"
                                   FontSize="12" FontWeight="SemiBold" VerticalAlignment="Center"/>
                        <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="â€”" Style="{StaticResource ActionBtn}" Width="28"
                                    Click="Minimize_Click" ToolTip="Minimize to button" Foreground="#6A6A6A"/>
                            <Button Content="âœ•" Style="{StaticResource ActionBtn}" Width="28"
                                    Click="Close_Click" ToolTip="Close notepad" Foreground="#6A6A6A"/>
                        </StackPanel>
                    </DockPanel>
                </Border>

                <!-- â”€â”€â”€ Toolbar â”€â”€â”€ -->
                <Border Grid.Row="1" Background="#0A0A0A" Padding="4,2">
                    <DockPanel>
                        <!-- Left: formatting buttons -->
                        <StackPanel Orientation="Horizontal">
                            <ToggleButton x:Name="BoldBtn" Style="{StaticResource ToolBtn}" FontWeight="Bold"
                                          Content="B" Click="Bold_Click" ToolTip="Bold (Ctrl+B)"/>
                            <ToggleButton x:Name="ItalicBtn" Style="{StaticResource ToolBtn}" FontStyle="Italic"
                                          Content="I" Click="Italic_Click" ToolTip="Italic (Ctrl+I)"/>
                            <ToggleButton x:Name="UnderlineBtn" Style="{StaticResource ToolBtn}"
                                          Click="Underline_Click" ToolTip="Underline (Ctrl+U)">
                                <TextBlock Text="U" TextDecorations="Underline"/>
                            </ToggleButton>
                            <ToggleButton x:Name="StrikeBtn" Style="{StaticResource ToolBtn}"
                                          Click="Strike_Click" ToolTip="Strikethrough">
                                <TextBlock Text="S" TextDecorations="Strikethrough"/>
                            </ToggleButton>

                            <Border Width="1" Background="#2A2A2A" Margin="4,4"/>

                            <!-- Note management -->
                            <Button Style="{StaticResource ActionBtn}" Content="NOTES"
                                    Click="ShowNoteList_Click" ToolTip="View all notes"/>
                            <Button Style="{StaticResource ActionBtn}" Content="TEMPLATE"
                                    Click="NewFromTemplate_Click" ToolTip="New note from template"/>
                            <Button Style="{StaticResource ActionBtn}" Content="ï¼‹ NEW"
                                    Click="NewNote_Click" ToolTip="New empty note"/>

                            <Border Width="1" Background="#2A2A2A" Margin="4,4"/>

                            <!-- Shared notepad -->
                            <Button x:Name="SharedBtn" Style="{StaticResource ActionBtn}" Content="SHARED"
                                    Click="ShowSharedPanel_Click" ToolTip="Open or join a shared notepad"/>
                            <Button x:Name="LeaveSharedBtn" Style="{StaticResource ActionBtn}" Content="LEAVE"
                                    Click="LeaveShared_Click" ToolTip="Leave shared notepad session"
                                    Foreground="#FF6060" Visibility="Collapsed"/>
                        </StackPanel>

                        <!-- Right: delete -->
                        <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Style="{StaticResource ActionBtn}" Content="DEL" FontSize="11"
                                    Click="DeleteNote_Click" ToolTip="Delete current note" Foreground="#A0A0A0"/>
                        </StackPanel>
                    </DockPanel>
                </Border>

                <!-- â”€â”€â”€ Editor Area â”€â”€â”€ -->
                <Grid Grid.Row="2">
                    <!-- Rich text editor -->
                    <RichTextBox x:Name="Editor"
                                 Background="Transparent" Foreground="#D8D8D8" CaretBrush="#FFFFFF"
                                 BorderThickness="0" Padding="8" FontSize="13"
                                 AcceptsTab="True" AcceptsReturn="True"
                                 VerticalScrollBarVisibility="Auto"
                                 SelectionChanged="Editor_SelectionChanged"
                                 TextChanged="Editor_TextChanged"
                                 Visibility="Visible"/>

                    <!-- Form view (for [FORM] templates) -->
                    <Border x:Name="FormPanel" Background="Transparent" Visibility="Collapsed">
                        <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="8">
                            <StackPanel x:Name="FormStack" Margin="4"/>
                        </ScrollViewer>
                    </Border>

                    <!-- Note list (toggled) -->
                    <Border x:Name="NoteListPanel" Background="{StaticResource NpBgDark}"
                            Visibility="Collapsed">
                        <DockPanel>
                            <Border DockPanel.Dock="Top" Padding="8,6" Background="#0A0A0A">
                                <DockPanel>
                                    <TextBlock Text="YOUR NOTES" Foreground="{StaticResource NpGoldText}"
                                               FontWeight="SemiBold" FontSize="13" VerticalAlignment="Center"/>
                                    <Button DockPanel.Dock="Right" Style="{StaticResource ActionBtn}"
                                            Content="âœ• BACK" Click="HideNoteList_Click"
                                            HorizontalAlignment="Right"/>
                                </DockPanel>
                            </Border>
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <StackPanel x:Name="NoteListStack"/>
                            </ScrollViewer>
                        </DockPanel>
                    </Border>

                    <!-- Template picker (toggled) -->
                    <Border x:Name="TemplatePanel" Background="{StaticResource NpBgDark}"
                            Visibility="Collapsed">
                        <DockPanel>
                            <Border DockPanel.Dock="Top" Padding="8,6" Background="#0A0A0A">
                                <DockPanel>
                                    <TextBlock Text="CHOOSE A TEMPLATE" Foreground="{StaticResource NpGoldText}"
                                               FontWeight="SemiBold" FontSize="13" VerticalAlignment="Center"/>
                                    <Button DockPanel.Dock="Right" Style="{StaticResource ActionBtn}"
                                            Content="âœ• BACK" Click="HideTemplatePanel_Click"
                                            HorizontalAlignment="Right"/>
                                </DockPanel>
                            </Border>
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <StackPanel x:Name="TemplateListStack"/>
                            </ScrollViewer>
                        </DockPanel>
                    </Border>

                    <!-- Shared notepad panel -->
                    <Border x:Name="SharedPanel" Background="{StaticResource NpBgDark}"
                            Visibility="Collapsed">
                        <DockPanel>
                            <Border DockPanel.Dock="Top" Padding="8,6" Background="#0A0A0A">
                                <DockPanel>
                                    <TextBlock Text="SHARED NOTEPAD" Foreground="{StaticResource NpGoldText}"
                                               FontWeight="SemiBold" FontSize="13" VerticalAlignment="Center"/>
                                    <Button DockPanel.Dock="Right" Style="{StaticResource ActionBtn}"
                                            Content="âœ• BACK" Click="HideSharedPanel_Click"
                                            HorizontalAlignment="Right"/>
                                </DockPanel>
                            </Border>

                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <StackPanel Margin="12,10,12,12">

                                    <!-- â”€â”€ CREATE section â”€â”€ -->
                                    <TextBlock Text="CREATE" Foreground="{StaticResource NpGoldText}"
                                               FontWeight="SemiBold" FontSize="11" Margin="0,0,0,4"/>
                                    <TextBlock TextWrapping="Wrap" FontSize="11" Margin="0,0,0,8"
                                               Foreground="#A0A0A0">
                                        Set a password, then share it with your faction members so they can join.
                                    </TextBlock>

                                    <TextBlock Text="PASSWORD" Foreground="#6A6A6A" FontSize="10" Margin="0,0,0,4"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBox x:Name="CreatePasswordBox"
                                                 Grid.Column="0"
                                                 Background="#0A0A0A" Foreground="#D8D8D8"
                                                 CaretBrush="#FFFFFF"
                                                 BorderBrush="#2A2A2A" BorderThickness="1"
                                                 Padding="6,4" FontSize="12"
                                                 KeyDown="CreatePassword_KeyDown"/>
                                        <Button Grid.Column="1" Style="{StaticResource ActionBtn}"
                                                Content="ðŸŽ²" Width="30" Margin="2,0,0,0"
                                                Click="GeneratePassword_Click"
                                                ToolTip="Generate a random password"/>
                                    </Grid>

                                    <!-- Created success block: shows the password to share -->
                                    <Border x:Name="CreatedSuccessBlock" Visibility="Collapsed"
                                            Background="#0A1A0A" BorderBrush="#3A6A3A"
                                            BorderThickness="1" Padding="8,6" Margin="0,8,0,0">
                                        <StackPanel>
                                            <TextBlock Text="NOTEPAD CREATED â€” SHARE THIS PASSWORD:"
                                                       Foreground="#60FF60" FontSize="10" FontWeight="SemiBold"
                                                       Margin="0,0,0,4"/>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBox x:Name="CreatedPasswordDisplay"
                                                         Grid.Column="0"
                                                         Background="#0A0A0A" Foreground="#60FF60"
                                                         BorderBrush="#3A6A3A" BorderThickness="1"
                                                         Padding="4,2" FontSize="12" IsReadOnly="True"
                                                         FontFamily="Consolas"/>
                                                <Button Grid.Column="1" Style="{StaticResource ActionBtn}"
                                                        Content="COPY" Margin="4,0,0,0"
                                                        Click="CopyCreatedPassword_Click"/>
                                            </Grid>
                                        </StackPanel>
                                    </Border>

                                    <TextBlock x:Name="CreateErrorText" Text=""
                                               Foreground="#FF6060" FontSize="11"
                                               Margin="0,6,0,0" Visibility="Collapsed"
                                               TextWrapping="Wrap"/>

                                    <Button Style="{StaticResource ActionBtn}" Content="CREATE SHARED NOTEPAD"
                                            Margin="0,8,0,0" HorizontalAlignment="Stretch"
                                            Click="CreateShared_Click" FontSize="11"/>

                                    <!-- Divider -->
                                    <Border Height="1" Background="#2A2A2A" Margin="0,14,0,12"/>

                                    <!-- â”€â”€ JOIN section â”€â”€ -->
                                    <TextBlock Text="JOIN" Foreground="{StaticResource NpGoldText}"
                                               FontWeight="SemiBold" FontSize="11" Margin="0,0,0,4"/>
                                    <TextBlock TextWrapping="Wrap" FontSize="11" Margin="0,0,0,8"
                                               Foreground="#A0A0A0">
                                        Enter a password someone shared with you to join their notepad.
                                    </TextBlock>

                                    <TextBlock Text="PASSWORD" Foreground="#6A6A6A" FontSize="10" Margin="0,0,0,4"/>
                                    <PasswordBox x:Name="SharedPasswordBox"
                                                 Background="#0A0A0A" Foreground="#D8D8D8"
                                                 BorderBrush="#2A2A2A" BorderThickness="1"
                                                 Padding="6,4" FontSize="12"
                                                 PasswordChar="â—"
                                                 KeyDown="SharedPassword_KeyDown"/>
                                    <TextBlock x:Name="SharedErrorText" Text=""
                                               Foreground="#FF6060" FontSize="11"
                                               Margin="0,6,0,0" Visibility="Collapsed"
                                               TextWrapping="Wrap"/>
                                    <Button Style="{StaticResource ActionBtn}" Content="JOIN SHARED NOTEPAD"
                                            Margin="0,8,0,0" HorizontalAlignment="Stretch"
                                            Click="JoinShared_Click" FontSize="11"/>

                                </StackPanel>
                            </ScrollViewer>
                        </DockPanel>
                    </Border>
                </Grid>

                <!-- â”€â”€â”€ Status Bar â”€â”€â”€ -->
                <Border Grid.Row="3" Background="{StaticResource NpBgDark}" Padding="8,3">
                    <DockPanel>
                        <TextBlock x:Name="NoteTitle" Text="UNTITLED NOTE" Foreground="{StaticResource NpDimText}"
                                   FontSize="11" VerticalAlignment="Center" MouseLeftButtonDown="NoteTitle_DoubleClick"/>
                        <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" HorizontalAlignment="Right">
                            <TextBlock x:Name="SharedBadge" Text="â— SHARED" Foreground="#60FF60"
                                       FontSize="10" VerticalAlignment="Center" Margin="0,0,8,0"
                                       Visibility="Collapsed"/>
                            <TextBlock x:Name="SavedIndicator" Text="SAVED" Foreground="#A0A0A0"
                                       FontSize="10" VerticalAlignment="Center"/>
                        </StackPanel>
                    </DockPanel>
                </Border>
            </Grid>
        </Border>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MINIMIZED BUTTON â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Button x:Name="MinimizedButton" Visibility="Collapsed"
                Width="36" Height="36" VerticalAlignment="Top" HorizontalAlignment="Left"
                Click="Restore_Click" ToolTip="Open BMS Notepad">
            <Button.Template>
                <ControlTemplate TargetType="Button">
                    <Border x:Name="bd" Background="{StaticResource NpBgDark}"
                            BorderBrush="#2A2A2A" BorderThickness="1">
                        <Grid>
                            <Rectangle Fill="{StaticResource OverlayDottedTexture}" Opacity="0.35" IsHitTestVisible="False"/>
                            <TextBlock Text="ðŸ“" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Grid>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="bd" Property="Background" Value="#0A0A0A"/>
                            <Setter TargetName="bd" Property="BorderBrush" Value="#CCCCCC"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Button.Template>
        </Button>
    </Grid>
</Window>


